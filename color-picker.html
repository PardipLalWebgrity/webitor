<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>Document</title>
</head>
<body>
 <style>
  *{padding: 0;margin: 0;box-sizing: border-box;}
  .color-area {width: 200px;height: 200px;margin: 5px;background:linear-gradient(to top, #000 0%, rgb(0 0 0 / 0) 100%),linear-gradient(to right, #fff 0%, rgb(255 255 255 / 0) 100%);background-color: red;}
  .hue{width: 200px;height: 30px;margin: 5px;background: linear-gradient( to right, #f00 0%, #ff0 16.66%, #0f0 33.33%, #0ff 50%, #00f 66.66%, #f0f 83.33%, #f00 100% );position: relative;}

  [type="range"]{position: absolute;width: 100%;height: 100%;top:0;left: 0;background: transparent;-webkit-appearance: none;appearance: none;border:none;padding: 0;}
  [type="range"]::-moz-range-thumb {width: 4px;height:28px;border:2px solid #fff;background: transparent;box-shadow: rgba(149, 157, 165, 0.2) 0px 8px 24px;}
  [type="range"]::-webkit-slider-thumb {width: 4px;height:28px;border:2px solid #fff;background: transparent;box-shadow: rgba(149, 157, 165, 0.2) 0px 8px 24px;}
  [type="range"]::-webkit-slider-runnable-track {height: 28px;background: transparent;border-radius: 4px;}


 </style>
 
<div class="color-area" id="color-area"></div>
<div class="hue">
 <input type="range" class="hue-input" id="hue-input">
</div>


<script>

 const COLOR = {

   colorAreaWidth: 200,
   colorAreaHeight: 200,
   baseHue: 0,

   getColorAtPoint: function(x, y) {
     // Normalize to 0-1 range
     const s = Math.max(0, Math.min(1, x / this.colorAreaWidth));       // Saturation
     const v = 1 - Math.max(0, Math.min(1, y / this.colorAreaHeight));  // Brightness/Value

     // HSV to RGB conversion
     const c = v * s;
     const hPrime = this.baseHue / 60;
     const xVal = c * (1 - Math.abs(hPrime % 2 - 1));
     let r = 0, g = 0, b = 0;

     if (hPrime >= 0 && hPrime < 1) {
       r = c; g = xVal; b = 0;
     } else if (hPrime < 2) {
       r = xVal; g = c; b = 0;
     } else if (hPrime < 3) {
       r = 0; g = c; b = xVal;
     } else if (hPrime < 4) {
       r = 0; g = xVal; b = c;
     } else if (hPrime < 5) {
       r = xVal; g = 0; b = c;
     } else if (hPrime <= 6) {
       r = c; g = 0; b = xVal;
     }

     const m = v - c;
     r = Math.round((r + m) * 255);
     g = Math.round((g + m) * 255);
     b = Math.round((b + m) * 255);

     return {
       rgb: `rgb(${r}, ${g}, ${b})`,
       hex: '#' + [r, g, b].map(n => n.toString(16).padStart(2, '0')).join('')
     };
   },

   getHueGradientColorAt(percent) {
     const stops = [
       { pct: 0,     color: [255,   0,   0] }, // red
       { pct: 16.66, color: [255, 255,   0] }, // yellow
       { pct: 33.33, color: [  0, 255,   0] }, // green
       { pct: 50.00, color: [  0, 255, 255] }, // cyan
       { pct: 66.66, color: [  0,   0, 255] }, // blue
       { pct: 83.33, color: [255,   0, 255] }, // magenta
       { pct: 100.0, color: [255,   0,   0] }  // red again
     ];

     // Clamp percentage
     percent = Math.max(0, Math.min(100, percent));

     // Find the two surrounding stops
     for (let i = 0; i < stops.length - 1; i++) {
       const stop1 = stops[i];
       const stop2 = stops[i + 1];

       if (percent >= stop1.pct && percent <= stop2.pct) {
         const range = stop2.pct - stop1.pct;
         const ratio = (percent - stop1.pct) / range;

         const r = Math.round(stop1.color[0] + (stop2.color[0] - stop1.color[0]) * ratio);
         const g = Math.round(stop1.color[1] + (stop2.color[1] - stop1.color[1]) * ratio);
         const b = Math.round(stop1.color[2] + (stop2.color[2] - stop1.color[2]) * ratio);

         return {
           rgb: `rgb(${r}, ${g}, ${b})`,
           hex: '#' + [r, g, b].map(v => v.toString(16).padStart(2, '0')).join('')
         };
       }
     }

     // Fallback
     return { rgb: 'rgb(255,0,0)', hex: '#ff0000' };
   },

   getBaseHueFromColor(color) {
     // Parse the RGB(A) string
     const match = color.match(/rgba?\s*\(\s*(\d+),\s*(\d+),\s*(\d+)/i);
     if (!match) return null;

     const r = parseInt(match[1]) / 255;
     const g = parseInt(match[2]) / 255;
     const b = parseInt(match[3]) / 255;

     const max = Math.max(r, g, b);
     const min = Math.min(r, g, b);
     const delta = max - min;

     let hue = 0;

     if (delta !== 0) {
       if (max === r) {
         hue = ((g - b) / delta) % 6;
       } else if (max === g) {
         hue = (b - r) / delta + 2;
       } else if (max === b) {
         hue = (r - g) / delta + 4;
       }
       hue *= 60;
       if (hue < 0) hue += 360;
     }

     return Math.round(hue); // base hue in degrees (0–360)
   },

   getPickerCoordinatesFromColor(rgb) {
     const { r, g, b } = rgb;
     const { s, v } = this.rgbToHsv(r, g, b);

     const x = Math.round(s * this.colorAreaWidth);         // 0 → 200
     const y = Math.round((1 - v) * this.colorAreaHeight);   // Brightness is inverted

     return { x, y };
   },

   rgbToHsv(r, g, b) {
     r /= 255;
     g /= 255;
     b /= 255;

     const max = Math.max(r, g, b), min = Math.min(r, g, b);
     const d = max - min;

     let h = 0;
     if (d !== 0) {
       if (max === r) h = ((g - b) / d) % 6;
       else if (max === g) h = (b - r) / d + 2;
       else h = (r - g) / d + 4;
       h *= 60;
       if (h < 0) h += 360;
     }

     const s = max === 0 ? 0 : d / max;
     const v = max;

     return { h, s, v };
   }




 } 

 const hueInputEl = document.querySelector('#hue-input');
 const colorAreaEl = document.querySelector('#color-area');
 const colorAreaElRect = colorAreaEl.getBoundingClientRect();

 hueInputEl.addEventListener('input', () => {
   const color = COLOR.getHueGradientColorAt(hueInputEl.value);
   colorAreaEl.style.backgroundColor = color.hex;
 })

 hueInputEl.addEventListener('change', () => {
   const color = COLOR.getHueGradientColorAt(hueInputEl.value);
   COLOR.baseHue = COLOR.getBaseHueFromColor(color.rgb);   
 })

 colorAreaEl.addEventListener('pointerdown', (e)=>{
   const x = e.clientX-colorAreaElRect.x;
   const y = e.clientY-colorAreaElRect.y;
   const color = COLOR.getColorAtPoint(x,y);
   document.body.style.backgroundColor = color.hex;
 })

const color = COLOR.getPickerCoordinatesFromColor();
console.log(color);

 
</script> 

</body>
</html>